<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE project>
<project name="junit" basedir=".">

    <property name="tests.reports.dir" value="${reports.tmp.dir}/tests" />

    <target name="unittest" unless="skip.test" description="Run all unit tests.">
        <mkdir dir="${tests.reports.dir}" />
        <junit printsummary="yes" haltonfailure="no" fork="yes" failureProperty="tests.failed" errorProperty="tests.failed" filtertrace="yes" forkMode="once" maxMemory="256m">
            <jvmarg value="-Djava.awt.headless=true" />
            <sysproperty key="net.sourceforge.cobertura.datafile" file="${instrumented.tmp.dir}/cobertura.ser" />
            <assertions>
                <enable />
            </assertions>
            <classpath>
                <path refid="build.classpath" />
                <path refid="build.support.classpath" />
                <pathelement location="${instrumented.tmp.dir}" />
                <pathelement location="${build.tmp.dir}" />
                <pathelement location="${conf.dir}/override" />
                <pathelement location="${conf.dir}/logging" />
                <pathelement location="${conf.dir}/spring" />
            </classpath>
            <formatter type="xml" />
            <batchtest todir="${build.tmp.dir}">
                <fileset dir="${test.src.dir}">
                    <include name="**/*Test.java" />
                </fileset>
            </batchtest>
        </junit>
        <junitreport tofile="${tests.reports.dir}/TESTS-TestSuites.xml">
            <fileset dir="${build.tmp.dir}">
                <include name="TEST-*.xml" />
            </fileset>
            <report format="frames" todir="${tests.reports.dir}" />
        </junitreport>
        <fail message="One or more unit tests have failed!!!" if="tests.failed" />
    </target>

    <target name="unittest.single" unless="skip.test" description="Run an individual unit test defined as -DClassUnderTest (no need for the .java at the end).">
        <mkdir dir="${tests.reports.dir}" />
        <junit printsummary="yes" haltonfailure="no" fork="yes" failureProperty="tests.failed" errorProperty="tests.failed" filtertrace="yes" forkMode="once" maxMemory="256m">
            <jvmarg value="-Djava.awt.headless=true" />
            <sysproperty key="net.sourceforge.cobertura.datafile" file="${instrumented.tmp.dir}/cobertura.ser" />
            <assertions>
                <enable />
            </assertions>
            <classpath>
                <path refid="build.classpath" />
                <path refid="build.support.classpath" />
                <pathelement location="${instrumented.tmp.dir}" />
                <pathelement location="${build.tmp.dir}" />
                <pathelement location="${conf.dir}/override" />
                <pathelement location="${conf.dir}/logging" />
                <pathelement location="${conf.dir}/spring" />
            </classpath>
            <formatter type="xml" />
            <batchtest todir="${build.tmp.dir}">
                <fileset dir="${test.src.dir}">
                    <include name="**/${test}.java" />
                </fileset>
            </batchtest>
        </junit>
        <junitreport tofile="${tests.reports.dir}/TESTS-TestSuites.xml">
            <fileset dir="${build.tmp.dir}">
                <include name="TEST-*.xml" />
            </fileset>
            <report format="frames" todir="${tests.reports.dir}" />
        </junitreport>
        <fail message="One or more unit tests have failed!!!" if="tests.failed" />
    </target>

</project>
